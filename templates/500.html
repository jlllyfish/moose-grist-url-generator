{% extends "base.html" %}

{% block title %}Erreur serveur - {{ super() }}{% endblock %}

{% block content %}
<div class="fr-grid-row fr-grid-row--center">
    <div class="fr-col-12 fr-col-md-8 fr-col-lg-6">
        
        <!-- Alerte d'erreur principale -->
        <div class="fr-alert fr-alert--error fr-mb-6w">
            <h1 class="fr-alert__title">
                Erreur 500 - Erreur interne du serveur
            </h1>
            <p class="fr-alert__desc">
                Une erreur inattendue s'est produite sur le serveur. Veuillez réessayer dans quelques instants.
            </p>
        </div>

        <!-- Contenu principal -->
        <div class="fr-card fr-card--no-arrow">
            <div class="fr-card__body">
                <div class="fr-card__content">
                    <h2 class="fr-card__title">
                        Que s'est-il passé ?
                    </h2>
                    <div class="fr-card__desc">
                        <p>Le serveur a rencontré une erreur interne et n'a pas pu traiter votre demande.</p>
                        
                        <div class="fr-highlight fr-mt-3w">
                            <h4>Causes possibles :</h4>
                            <ul>
                                <li><strong>Configuration :</strong> Problème de configuration de l'application</li>
                                <li><strong>Clé API :</strong> Problème avec la clé API Grist</li>
                                <li><strong>Fichiers manquants :</strong> Fichiers DSFR ou templates non trouvés</li>
                                <li><strong>Connectivité :</strong> Problème de connexion à l'API Grist</li>
                            </ul>
                        </div>
                    </div>
                    <div class="fr-card__footer">
                        <div class="fr-btns-group fr-btns-group--inline">
                            <a href="/" class="fr-btn fr-btn--primary">
                                Retour à l'accueil
                            </a>
                            <button type="button" 
                                    class="fr-btn fr-btn--secondary"
                                    onclick="location.reload()">
                                Recharger la page
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Solutions -->
        <div class="fr-card fr-card--no-arrow fr-mt-4w">
            <div class="fr-card__body">
                <div class="fr-card__content">
                    <h3 class="fr-card__title">
                        Solutions possibles
                    </h3>
                    <div class="fr-card__desc">
                        <div class="fr-accordions-group">
                            <section class="fr-accordion">
                                <h4 class="fr-accordion__title">
                                    <button class="fr-accordion__btn" aria-expanded="false" aria-controls="accordion-1">
                                        1. Vérifier la configuration
                                    </button>
                                </h4>
                                <div class="fr-collapse" id="accordion-1">
                                    <div class="fr-accordion__body">
                                        <div class="fr-accordion__inner">
                                            <ul>
                                                <li>Vérifiez que le fichier <code>.env</code> existe et contient votre clé API</li>
                                                <li>Testez votre clé API via le bouton "Tester la clé API"</li>
                                                <li>Vérifiez les logs de l'application dans la console</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </section>
                            
                            <section class="fr-accordion">
                                <h4 class="fr-accordion__title">
                                    <button class="fr-accordion__btn" aria-expanded="false" aria-controls="accordion-2">
                                        2. Vérifier les fichiers DSFR
                                    </button>
                                </h4>
                                <div class="fr-collapse" id="accordion-2">
                                    <div class="fr-accordion__body">
                                        <div class="fr-accordion__inner">
                                            <p>Vérifiez que ces fichiers existent :</p>
                                            <ul>
                                                <li><code>static/dsfr/css/dsfr.min.css</code></li>
                                                <li><code>static/dsfr/js/dsfr.module.min.js</code></li>
                                                <li><code>static/dsfr/fonts/</code> (dossier complet)</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </section>
                            
                            <section class="fr-accordion">
                                <h4 class="fr-accordion__title">
                                    <button class="fr-accordion__btn" aria-expanded="false" aria-controls="accordion-3">
                                        3. Redémarrer l'application
                                    </button>
                                </h4>
                                <div class="fr-collapse" id="accordion-3">
                                    <div class="fr-accordion__body">
                                        <div class="fr-accordion__inner">
                                            <p>Redémarrez l'application Flask :</p>
                                            <div class="fr-highlight">
                                                <pre><code>python app.py</code></pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Informations techniques -->
        <div class="fr-card fr-card--no-arrow fr-mt-4w">
            <div class="fr-card__body">
                <div class="fr-card__content">
                    <h3 class="fr-card__title">
                        Informations techniques
                    </h3>
                    <div class="fr-card__desc">
                        <dl class="fr-metadata">
                            <dt>Code d'erreur :</dt>
                            <dd>500 - Internal Server Error</dd>
                            <dt>URL demandée :</dt>
                            <dd>{{ request.url }}</dd>
                            <dt>Méthode :</dt>
                            <dd>{{ request.method }}</dd>
                            <dt>User-Agent :</dt>
                            <dd class="fr-text--xs">{{ request.user_agent.string }}</dd>
                            <dt>Timestamp :</dt>
                            <dd id="timestamp">-</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contact développeur -->
        <div class="fr-notice fr-notice--info fr-mt-4w">
            <div class="fr-container">
                <div class="fr-notice__body">
                    <p class="fr-notice__title">
                        Problème persistant ?
                    </p>
                    <p class="fr-notice__desc">
                        Si l'erreur persiste, contactez l'administrateur de l'application avec les informations techniques ci-dessus.
                    </p>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
// Afficher le timestamp actuel
document.getElementById('timestamp').textContent = new Date().toLocaleString('fr-FR');
</script>
{% endblock %}